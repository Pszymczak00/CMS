<h2>Złóż zamówienie na dietę {{cateringName}}</h2>
@if (!isAuthenticated) {
  <div class="login-required">
    <p>Musisz się zalogować, aby złożyć zamówienie.</p>
    <p>Kliknij przycisk "Zaloguj" w prawym górnym rogu, aby się zalogować lub zarejestrować.</p>
  </div>
} @else {
<form (ngSubmit)="onSubmit()" #placeOrderForm="ngForm">

  <div class="date-picker">
    <label class="date-picker__label">Dni dostawy:</label>
    <div class="date-picker__controls">
      <button type="button" class="secondary-button" (click)="toggleCalendar()">
        {{ showCalendar ? 'Zamknij kalendarz' : 'Wybierz daty' }}
      </button>
    </div>
    @if (showCalendar) {
      <div class="calendar-overlay">
        <mat-calendar
          [minDate]="minDate"
          [maxDate]="maxDate"
          [dateFilter]="dateFilter"
          [dateClass]="dateClass"
          (selectedChange)="onDateSelected($event)">
        </mat-calendar>
        <button type="button" class="primary-button small" (click)="closeCalendar()">Gotowe</button>
      </div>
    }
  </div>

  <div>
    <label for="count">Liczba kalorii:</label>
    <select
      id="count"
      name="count"
      [(ngModel)]="order.count"
      (ngModelChange)="onCountChange()"
      required
      #count="ngModel"
    >
      @for (number of numbers; track number) {
        <option [ngValue]="number">Kalorie: {{ number.kcal }}, cena {{number.price}} zł</option>
      }
    </select>
    @if (count.invalid && count.touched) {
      <div class="error-message">
        Wybierz liczbę.
      </div>
    }
  </div>

  <div class="date-difference">
    @if (selectedDates.length && order.count) {
      <p>Łączna cena ({{selectedDates.length}} dni): {{ totalPrice }} zł</p>
    }
  </div>
  <button class="primary-button" type="submit" [disabled]="!placeOrderForm.form.valid || selectedDates.length === 0 || !order.count">Złóż zamówienie</button>
</form>
}
